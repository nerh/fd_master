
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      --><title>&#1054;&#1073;&#1088;&#1072;&#1073;&#1086;&#1090;&#1082;&#1072; &#1076;&#1072;&#1085;&#1085;&#1099;&#1093; &#1089; &#1086;&#1090;&#1084;&#1077;&#1090;&#1095;&#1080;&#1082;&#1072;</title><meta name="generator" content="MATLAB 7.10"><meta name="date" content="2011-02-09"><meta name="m-file" content="getSpeedParams"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h1>&#1054;&#1073;&#1088;&#1072;&#1073;&#1086;&#1090;&#1082;&#1072; &#1076;&#1072;&#1085;&#1085;&#1099;&#1093; &#1089; &#1086;&#1090;&#1084;&#1077;&#1090;&#1095;&#1080;&#1082;&#1072;</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">&#1054;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1077; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;</a></li><li><a href="#3">&#1048;&#1085;&#1080;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;</a></li><li><a href="#4">&#1054;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1077;&#1085;&#1080;&#1077; &#1091;&#1075;&#1083;&#1072; &#1087;&#1086;&#1074;&#1086;&#1088;&#1086;&#1090;&#1072; &#1080; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080; &#1084;&#1077;&#1078;&#1076;&#1091; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;&#1084;&#1080;</a></li><li><a href="#5">&#1088;&#1072;&#1089;&#1095;&#1080;&#1090;&#1099;&#1074;&#1072;&#1077;&#1084; &#1074;&#1088;&#1077;&#1084;&#1103; &#1084;&#1077;&#1078;&#1076;&#1091; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;&#1084;&#1080;</a></li><li><a href="#6">&#1089;&#1095;&#1080;&#1090;&#1072;&#1077;&#1084; &#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086; &#1087;&#1077;&#1088;&#1077;&#1089;&#1077;&#1095;&#1077;&#1085;&#1080;&#1081;</a></li><li><a href="#7">&#1079;&#1072;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1084; &#1074;&#1088;&#1077;&#1084;&#1103; &#1087;&#1077;&#1088;&#1077;&#1089;&#1077;&#1095;&#1077;&#1085;&#1080;&#1103;</a></li><li><a href="#8">&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084; &#1075;&#1088;&#1072;&#1085;&#1080;&#1094;&#1099; &#1094;&#1080;&#1082;&#1083;&#1086;&#1074;</a></li><li><a href="#9">&#1047;&#1072;&#1087;&#1080;&#1089;&#1099;&#1074;&#1077;&#1084; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103; &#1091;&#1075;&#1083;&#1072; &#1074; &#1090;&#1077;&#1082;&#1091;&#1097;&#1080;&#1081; &#1084;&#1086;&#1084;&#1077;&#1085;&#1090; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080;</a></li><li><a href="#10">&#1048;&#1097;&#1077;&#1084; &#1083;&#1086;&#1082;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081; &#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1091;&#1084;</a></li><li><a href="#12">&#1056;&#1072;&#1089;&#1095;&#1077;&#1090; &#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1086;&#1081; &#1089;&#1082;&#1086;&#1088;&#1086;&#1089;&#1090;&#1080; &#1080; &#1091;&#1089;&#1082;&#1086;&#1088;&#1077;&#1085;&#1080;&#1103;</a></li><li><a href="#13">&#1053;&#1072;&#1093;&#1086;&#1076;&#1080;&#1084; &#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1091;&#1102; &#1089;&#1082;&#1086;&#1088;&#1086;&#1089;&#1090;&#1100;</a></li><li><a href="#14">&#1054;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1091;&#1075;&#1083;&#1072; &#1087;&#1086;&#1074;&#1086;&#1088;&#1086;&#1090;&#1072; &#1076;&#1083;&#1103; &#1083;&#1102;&#1073;&#1086;&#1075;&#1086; &#1084;&#1086;&#1084;&#1077;&#1085;&#1090;&#1072; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080;</a></li><li><a href="#15">&#1091;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084; &#1085;&#1091;&#1083;&#1077;&#1074;&#1099;&#1084; &#1091;&#1075;&#1086;&#1083; &#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1074;&#1091;&#1102;&#1097;&#1080;&#1081; &#1085;&#1072;&#1095;&#1072;&#1083;&#1091; &#1087;&#1077;&#1088;&#1074;&#1086;&#1075;&#1086; &#1094;&#1080;&#1082;&#1083;&#1072;</a></li><li><a href="#16">&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1084; &#1091;&#1089;&#1082;&#1086;&#1088;&#1077;&#1085;&#1080;&#1077;</a></li><li><a href="#17">&#1047;&#1072;&#1087;&#1080;&#1089;&#1100; &#1088;&#1072;&#1089;&#1095;&#1080;&#1090;&#1072;&#1085;&#1085;&#1099;&#1093; &#1093;&#1072;&#1088;&#1072;&#1082;&#1090;&#1077;&#1088;&#1080;&#1089;&#1090;&#1080;&#1082;</a></li><li><a href="#18">&#1042;&#1080;&#1079;&#1091;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103; &#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;&#1086;&#1074;</a></li></ul></div><h2>&#1054;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1077; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;<a name="1"></a></h2><pre class="codeinput"><span class="keyword">function</span> [ result ] = getSpeedParams( marker, TDC, freq, marksPerCircle )
</pre><pre class="codeinput"><span class="comment">%getSpeedParams</span>
<span class="comment">%</span>
<span class="comment">%&#1042;&#1093;&#1086;&#1076;&#1085;&#1099;&#1077; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099;:</span>
<span class="comment">%   marker - &#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1090;&#1099; &#1086;&#1090;&#1084;&#1077;&#1090;&#1095;&#1080;&#1082;&#1072;</span>
<span class="comment">%   TDC - &#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1090;&#1099; &#1086;&#1090;&#1084;&#1077;&#1090;&#1095;&#1080;&#1082;&#1072; (&#1074;&#1084;&#1090;)</span>
<span class="comment">%   freq - &#1095;&#1072;&#1089;&#1090;&#1086;&#1090;&#1072; (&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086; &#1082;&#1074;&#1072;&#1085;&#1090;&#1086;&#1074; &#1074; &#1089;&#1077;&#1082;&#1091;&#1085;&#1076;&#1091;)</span>
<span class="comment">%   marksPerCircle - &#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086; &#1086;&#1090;&#1084;&#1077;&#1090;&#1086;&#1082; &#1076;&#1083;&#1103; &#1086;&#1076;&#1085;&#1086;&#1075;&#1086; &#1086;&#1073;&#1086;&#1088;&#1086;&#1090;&#1072; &#1074;&#1072;&#1083;&#1072;</span>
<span class="comment">%</span>
<span class="comment">%&#1042;&#1099;&#1093;&#1086;&#1076;&#1085;&#1099;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;:</span>
<span class="comment">%   result - &#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072; &#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1097;&#1072;&#1103; &#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1085;&#1091;&#1102; &#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102;</span>
<span class="comment">%       result.circleBeginTime - &#1072;&#1073;&#1089;&#1094;&#1080;&#1089;&#1089;&#1072; &#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1082;&#1072;&#1078;&#1076;&#1086;&#1075;&#1086; &#1094;&#1080;&#1082;&#1083;&#1072; ()</span>
<span class="comment">%       result.circleEndTime - &#1072;&#1073;&#1089;&#1094;&#1080;&#1089;&#1089;&#1072; &#1082;&#1086;&#1085;&#1094;&#1072; &#1082;&#1072;&#1078;&#1076;&#1086;&#1075;&#1086; &#1094;&#1080;&#1082;&#1083;&#1072;</span>
<span class="comment">%       result.angle_time - &#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072;, &#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1097;&#1072;&#1103; &#1089;&#1086;&#1087;&#1086;&#1089;&#1090;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1077; &#1091;&#1075;&#1083;&#1072;</span>
<span class="comment">%                           &#1087;&#1086;&#1074;&#1086;&#1088;&#1086;&#1090;&#1072; &#1074;&#1088;&#1084;&#1077;&#1085;&#1080;.</span>
<span class="comment">%       result.speed - &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1086;&#1081; &#1089;&#1082;&#1086;&#1088;&#1086;&#1089;&#1090;&#1080;</span>
<span class="comment">%       result.speed_absc - &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103; &#1072;&#1073;&#1089;&#1094;&#1080;&#1089;&#1089;&#1099; &#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1086;&#1081; &#1089;&#1082;&#1086;&#1088;&#1086;&#1089;&#1090;&#1080;</span>
<span class="comment">%       result.acceleration - &#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1086;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1091;&#1089;&#1082;&#1086;&#1088;&#1077;&#1085;&#1080;&#1103;</span>
<span class="comment">%       result.acceleration_absc - &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103; &#1072;&#1073;&#1089;&#1094;&#1080;&#1089;&#1089;&#1099; &#1091;&#1089;&#1082;&#1086;&#1088;&#1077;&#1085;&#1080;&#1103;</span>
<span class="comment">%       result.leTime - &#1074;&#1088;&#1077;&#1084;&#1103; &#1084;&#1077;&#1078;&#1076;&#1091; &#1087;&#1077;&#1088;&#1077;&#1076;&#1085;&#1080;&#1084;&#1080; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;&#1084;&#1080; &#1086;&#1090;&#1084;&#1077;&#1090;&#1095;&#1080;&#1082;&#1072;</span>
<span class="comment">%       result.teTime - &#1074;&#1088;&#1077;&#1084;&#1103; &#1084;&#1077;&#1078;&#1076;&#1091; &#1079;&#1072;&#1076;&#1085;&#1080;&#1084;&#1080; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;&#1084;&#1080; &#1086;&#1090;&#1084;&#1077;&#1090;&#1095;&#1080;&#1082;&#1072;</span>
</pre><h2>&#1048;&#1085;&#1080;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;<a name="3"></a></h2><pre class="codeinput"><span class="comment">%&#1091;&#1075;&#1086;&#1083;, &#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1074;&#1091;&#1102;&#1097;&#1080;&#1081; &#1086;&#1076;&#1085;&#1086;&#1081; &#1086;&#1090;&#1084;&#1077;&#1090;&#1082;&#1077;</span>
markAngle = 360/marksPerCircle;
markAngleRad = degtorad(markAngle);

angle = zeros(1,length(marker))*NaN; <span class="comment">%&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1091;&#1075;&#1083;&#1072; &#1074; &#1103;&#1095;&#1077;&#1081;&#1082;&#1072;&#1093; &#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1097;&#1080;&#1093; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; NaN &#1073;&#1091;&#1076;&#1077;&#1090; &#1088;&#1072;&#1089;&#1089;&#1095;&#1080;&#1090;&#1072;&#1085;&#1086; &#1087;&#1086; &#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1086;&#1081; &#1089;&#1082;&#1086;&#1088;&#1086;&#1089;&#1090;&#1080;</span>
angle(1) = 0;
crossingTime = [];

<span class="comment">%&#1075;&#1088;&#1072;&#1085;&#1080;&#1094;&#1099; &#1094;&#1080;&#1082;&#1083;&#1086;&#1074; (&#1084;&#1077;&#1078;&#1076;&#1091; &#1076;&#1074;&#1091;&#1084;&#1103; &#1087;&#1080;&#1082;&#1072;&#1084;&#1080; &#1086;&#1090;&#1084;&#1077;&#1090;&#1095;&#1080;&#1082;&#1072;)</span>
circleBeginTime = [1];
circleEndTime = [];

<span class="comment">%&#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1072;&#1103; &#1089;&#1082;&#1086;&#1088;&#1086;&#1089;&#1090;&#1100;</span>
mSpeed = [];
<span class="comment">%&#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1086;&#1077; &#1091;&#1089;&#1082;&#1086;&#1088;&#1077;&#1085;&#1080;&#1077;</span>
mAcc = [];
<span class="comment">%&#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1072;&#1103; &#1089;&#1082;&#1086;&#1088;&#1086;&#1089;&#1090;&#1100; &#1087;&#1086; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080; &#1084;&#1077;&#1078;&#1076;&#1091; &#1087;&#1077;&#1088;&#1077;&#1076;&#1085;&#1080;&#1084;&#1080; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;&#1084;&#1080;</span>
mSpeedLE = [];
<span class="comment">%&#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1086;&#1077; &#1091;&#1089;&#1082;&#1086;&#1088;&#1077;&#1085;&#1080;&#1077; &#1087;&#1086; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080; &#1084;&#1077;&#1078;&#1076;&#1091; &#1087;&#1077;&#1088;&#1077;&#1076;&#1085;&#1080;&#1084;&#1080; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;&#1084;&#1080;</span>
mAccLE = [];
<span class="comment">%&#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1072;&#1103; &#1089;&#1082;&#1086;&#1088;&#1086;&#1089;&#1090;&#1100; &#1087;&#1086; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080; &#1084;&#1077;&#1078;&#1076;&#1091; &#1079;&#1072;&#1076;&#1085;&#1080;&#1084;&#1080; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;&#1084;&#1080;</span>
mSpeedTE = [];
<span class="comment">%&#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1086;&#1077; &#1091;&#1089;&#1082;&#1086;&#1088;&#1077;&#1085;&#1080;&#1077; &#1087;&#1086; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080; &#1084;&#1077;&#1078;&#1076;&#1091; &#1079;&#1072;&#1076;&#1085;&#1080;&#1084;&#1080; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;&#1084;&#1080;</span>
mAccTE = [];

len = length(marker);
dt = 1/freq;

<span class="comment">%&#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082; &#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1072; &#1087;&#1077;&#1088;&#1077;&#1089;&#1077;&#1095;&#1077;&#1085;&#1080;&#1081; &#1086;&#1089;&#1080; &#1072;&#1073;&#1089;&#1094;&#1080;&#1089;&#1089;</span>
zeroCrossings = 0;

<span class="comment">%&#1074;&#1088;&#1077;&#1084;&#1103; &#1084;&#1077;&#1078;&#1076;&#1091; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;&#1084;&#1080;</span>
leTime = []; <span class="comment">%le = leading edge</span>
teTime = []; <span class="comment">%te = tailing edge</span>
leAbsc = [];
teAbsc = [];
<span class="comment">%&#1074;&#1088;&#1077;&#1084;&#1103; &#1086;&#1073;&#1085;&#1072;&#1088;&#1091;&#1078;&#1077;&#1085;&#1080;&#1103; &#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1077;&#1075;&#1086; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;</span>
lastLE = 0;
lastTE = 0;

<span class="comment">%&#1091;&#1075;&#1086;&#1083;, &#1085;&#1072; &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1073;&#1099;&#1083; &#1087;&#1086;&#1074;&#1077;&#1088;&#1085;&#1091;&#1090; &#1074;&#1072;&#1083; &#1074; &#1084;&#1086;&#1084;&#1077;&#1085;&#1090; &#1086;&#1073;&#1085;&#1072;&#1088;&#1091;&#1078;&#1077;&#1085;&#1080;&#1103; &#1087;&#1077;&#1088;&#1074;&#1086;&#1075;&#1086; &#1083;&#1086;&#1082;&#1072;&#1083;&#1100;&#1085;&#1086;&#1075;&#1086;</span>
<span class="comment">%&#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1091;&#1084;&#1072; &#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1090;&#1099; &#1086;&#1090;&#1084;&#1077;&#1090;&#1095;&#1080;&#1082;&#1072;</span>
initialCrossingsCount = NaN;

<span class="comment">%&#1083;&#1086;&#1082;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081; &#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1091;&#1084; &#1086;&#1088;&#1076;&#1080;&#1085;&#1090;&#1072; &#1086;&#1090;&#1084;&#1077;&#1090;&#1095;&#1080;&#1082;&#1072; &#1042;&#1052;&#1058;</span>
localMax = -inf;
<span class="comment">%&#1074;&#1088;&#1077;&#1084;&#1103; &#1086;&#1073;&#1085;&#1072;&#1088;&#1091;&#1078;&#1077;&#1085;&#1080;&#1103; &#1083;&#1086;&#1082;&#1072;&#1083;&#1100;&#1085;&#1086;&#1075;&#1086; &#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1091;&#1084;&#1072;</span>
localMaxTime = 0;
<span class="comment">%&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086; &#1087;&#1077;&#1088;&#1077;&#1089;&#1077;&#1095;&#1077;&#1085;&#1080;&#1081; &#1085;&#1072; &#1084;&#1086;&#1084;&#1077;&#1085;&#1090; &#1086;&#1073;&#1085;&#1072;&#1088;&#1091;&#1078;&#1077;&#1085;&#1080;&#1103; &#1083;&#1086;&#1082;&#1072;&#1083;&#1100;&#1085;&#1086;&#1075;&#1086; &#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1091;&#1084;&#1072;</span>
crossingsCountForLocalMax =  0;
<span class="comment">%&#1074;&#1088;&#1077;&#1084;&#1103; &#1087;&#1077;&#1088;&#1077;&#1089;&#1077;&#1095;&#1077;&#1085;&#1080;&#1103;, &#1087;&#1088;&#1077;&#1076;&#1096;&#1077;&#1089;&#1090;&#1074;&#1091;&#1102;&#1097;&#1077;&#1075;&#1086; &#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1091;&#1084;&#1091;</span>
crossingTimeBeforeTDC = 0;
<span class="comment">%&#1074;&#1088;&#1077;&#1084;&#1103; &#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1077;&#1075;&#1086; &#1087;&#1077;&#1088;&#1077;&#1089;&#1077;&#1095;&#1077;&#1085;&#1080;&#1103;</span>
lastCrossingTime = 0;
<span class="comment">%&#1087;&#1088;&#1080;&#1079;&#1085;&#1072;&#1082; &#1086;&#1073;&#1085;&#1072;&#1088;&#1091;&#1078;&#1077;&#1085;&#1080;&#1103; &#1083;&#1086;&#1082;&#1072;&#1083;&#1100;&#1085;&#1086;&#1075;&#1086; &#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1091;&#1084;&#1072;</span>
localMaxFounded = 0;
</pre><h2>&#1054;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1077;&#1085;&#1080;&#1077; &#1091;&#1075;&#1083;&#1072; &#1087;&#1086;&#1074;&#1086;&#1088;&#1086;&#1090;&#1072; &#1080; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080; &#1084;&#1077;&#1078;&#1076;&#1091; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;&#1084;&#1080;<a name="4"></a></h2><pre class="codeinput"><span class="keyword">for</span> i = 2:len
    <span class="comment">%&#1086;&#1090;&#1083;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084; &#1087;&#1077;&#1088;&#1077;&#1089;&#1077;&#1095;&#1077;&#1085;&#1080;&#1077; &#1085;&#1091;&#1083;&#1103;</span>
    <span class="keyword">if</span>((marker(1,i-1)&gt;0 &amp;&amp; marker(1,i) &lt;= 0) || (marker(1,i-1) &lt; 0 &amp;&amp; marker(1,i) &gt;= 0))
</pre><h2>&#1088;&#1072;&#1089;&#1095;&#1080;&#1090;&#1099;&#1074;&#1072;&#1077;&#1084; &#1074;&#1088;&#1077;&#1084;&#1103; &#1084;&#1077;&#1078;&#1076;&#1091; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;&#1084;&#1080;<a name="5"></a></h2><pre class="codeinput">        <span class="keyword">if</span>((marker(1,i-1)&lt;0 &amp;&amp; marker(1,i) &gt;= 0)) <span class="comment">%&#1087;&#1077;&#1088;&#1077;&#1076;&#1085;&#1080;&#1081; &#1092;&#1088;&#1086;&#1085;&#1090;</span>
            <span class="comment">%&#1047;&#1072;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1084; &#1074;&#1088;&#1077;&#1084;&#1103; &#1084;&#1077;&#1078;&#1076;&#1091; &#1087;&#1077;&#1088;&#1077;&#1076;&#1085;&#1080;&#1084;&#1080; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;&#1084;&#1080;</span>
            leTime = [leTime (i - lastLE)];
            lastLE = i;
            leAbsc = [leAbsc i];
        <span class="keyword">else</span>
            <span class="comment">%&#1047;&#1072;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1084; &#1074;&#1088;&#1077;&#1084;&#1103; &#1084;&#1077;&#1078;&#1076;&#1091; &#1079;&#1072;&#1076;&#1085;&#1080;&#1084;&#1080; &#1092;&#1088;&#1086;&#1085;&#1090;&#1072;&#1084;&#1080;</span>
            teTime = [teTime (i - lastTE)];
            lastTE = i;
            <span class="comment">%teAbsc = [teAbsc i];</span>
        <span class="keyword">end</span>
</pre><h2>&#1089;&#1095;&#1080;&#1090;&#1072;&#1077;&#1084; &#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086; &#1087;&#1077;&#1088;&#1077;&#1089;&#1077;&#1095;&#1077;&#1085;&#1080;&#1081;<a name="6"></a></h2><pre class="codeinput">        zeroCrossings = zeroCrossings+1;
</pre><h2>&#1079;&#1072;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1084; &#1074;&#1088;&#1077;&#1084;&#1103; &#1087;&#1077;&#1088;&#1077;&#1089;&#1077;&#1095;&#1077;&#1085;&#1080;&#1103;<a name="7"></a></h2><pre class="codeinput">        <span class="keyword">if</span> localMaxFounded==0
            lastCrossingTime = i;
        <span class="keyword">end</span>
</pre><h2>&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084; &#1075;&#1088;&#1072;&#1085;&#1080;&#1094;&#1099; &#1094;&#1080;&#1082;&#1083;&#1086;&#1074;<a name="8"></a></h2><pre class="codeinput">        <span class="keyword">if</span> (mod(zeroCrossings-initialCrossingsCount,2*marksPerCircle) == 0)
           circleBeginTime = [circleBeginTime i];
           circleEndTime = [circleEndTime i-1];
        <span class="keyword">end</span>
</pre><h2>&#1047;&#1072;&#1087;&#1080;&#1089;&#1099;&#1074;&#1077;&#1084; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103; &#1091;&#1075;&#1083;&#1072; &#1074; &#1090;&#1077;&#1082;&#1091;&#1097;&#1080;&#1081; &#1084;&#1086;&#1084;&#1077;&#1085;&#1090; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080;<a name="9"></a></h2><pre class="codeinput">        <span class="comment">%crossingTime = [crossingTime i];</span>
        angle(1,i) = zeroCrossings*markAngle;
</pre><h2>&#1048;&#1097;&#1077;&#1084; &#1083;&#1086;&#1082;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081; &#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1091;&#1084;<a name="10"></a></h2><p>&#1051;&#1086;&#1082;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081; &#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1091;&#1084; &#1080;&#1097;&#1077;&#1090;&#1089;&#1103; &#1074; &#1087;&#1088;&#1086;&#1084;&#1077;&#1078;&#1091;&#1090;&#1082;&#1077; &#1086;&#1090; 0 &#1076;&#1086; 720 &#1075;&#1088;&#1072;&#1076;&#1091;&#1089;&#1086;&#1074;</p><pre class="codeinput">        <span class="comment">%&#1086;&#1073;&#1085;&#1086;&#1074;&#1083;&#1103;&#1077;&#1084; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1091;&#1084;&#1072;</span>
        <span class="keyword">if</span> zeroCrossings &lt; 2*marksPerCircle
            <span class="keyword">if</span> TDC(1,i) &gt; localMax
                localMax = TDC(1,i);
                localMaxTime = i;
                crossingTimeBeforeTDC = lastCrossingTime;
                crossingsCountForLocalMax = zeroCrossings;
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="comment">%&#1091;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084; &#1085;&#1072;&#1095;&#1072;&#1083;&#1086; &#1087;&#1077;&#1088;&#1074;&#1086;&#1075;&#1086; &#1094;&#1080;&#1082;&#1083;&#1072;</span>
        <span class="keyword">if</span> zeroCrossings == 2*marksPerCircle
            initialCrossingsCount = crossingsCountForLocalMax;
            circleBeginTime = crossingTimeBeforeTDC;
            circleEndTime = [];
            localMaxFounded = 1;
        <span class="keyword">end</span>
</pre><pre class="codeinput">    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><h2>&#1056;&#1072;&#1089;&#1095;&#1077;&#1090; &#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1086;&#1081; &#1089;&#1082;&#1086;&#1088;&#1086;&#1089;&#1090;&#1080; &#1080; &#1091;&#1089;&#1082;&#1086;&#1088;&#1077;&#1085;&#1080;&#1103;<a name="12"></a></h2><h2>&#1053;&#1072;&#1093;&#1086;&#1076;&#1080;&#1084; &#1084;&#1075;&#1085;&#1086;&#1074;&#1077;&#1085;&#1085;&#1091;&#1102; &#1089;&#1082;&#1086;&#1088;&#1086;&#1089;&#1090;&#1100;<a name="13"></a></h2><pre class="codeinput"><span class="comment">%[sx mSpeed] = diff_pp(crossingTime*dt,angle(crossingTime));</span>
<span class="comment">%[sxTE mSpeedTE] = diff_pp(teAbsc*dt,angle(teAbsc));</span>
[sxLE mSpeedLE] = diff_pp(leAbsc*dt,angle(leAbsc));
</pre><h2>&#1054;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1091;&#1075;&#1083;&#1072; &#1087;&#1086;&#1074;&#1086;&#1088;&#1086;&#1090;&#1072; &#1076;&#1083;&#1103; &#1083;&#1102;&#1073;&#1086;&#1075;&#1086; &#1084;&#1086;&#1084;&#1077;&#1085;&#1090;&#1072; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080;<a name="14"></a></h2><pre class="codeinput"><span class="keyword">for</span> i = 2:len
   <span class="keyword">if</span> isnan(angle(i))
       <span class="comment">%&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1084; &#1084;&#1086;&#1084;&#1077;&#1085;&#1090; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080; &#1085;&#1072;&#1080;&#1073;&#1086;&#1083;&#1077;&#1077; &#1073;&#1083;&#1080;&#1079;&#1082;&#1080;&#1081; &#1082; &#1090;&#1077;&#1082;&#1091;&#1097;&#1077;&#1084;&#1091;</span>
       [~, closestTime] = min(abs(sxLE-i*dt));
       angle(i) = angle(i-1) + mSpeedLE(closestTime) * dt;
   <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><h2>&#1091;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084; &#1085;&#1091;&#1083;&#1077;&#1074;&#1099;&#1084; &#1091;&#1075;&#1086;&#1083; &#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1074;&#1091;&#1102;&#1097;&#1080;&#1081; &#1085;&#1072;&#1095;&#1072;&#1083;&#1091; &#1087;&#1077;&#1088;&#1074;&#1086;&#1075;&#1086; &#1094;&#1080;&#1082;&#1083;&#1072;<a name="15"></a></h2><pre class="codeinput">angle = angle - initialCrossingsCount*markAngle;
</pre><h2>&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1084; &#1091;&#1089;&#1082;&#1086;&#1088;&#1077;&#1085;&#1080;&#1077;<a name="16"></a></h2><pre class="codeinput">[sxLE_unique n] = unique(sxLE,<span class="string">'first'</span>);
mSpeedLE_unique = mSpeedLE(n);
[axLE mAccLE] = diff_pp(sxLE_unique, mSpeedLE_unique);

<span class="comment">%[sxTE_unique n] = unique(sxTE,'first');</span>
<span class="comment">%mSpeedTE_unique = mSpeedTE(n);</span>
<span class="comment">%[axTE mAccTE] = diff_pp(sxTE_unique, mSpeedTE_unique);</span>
</pre><h2>&#1047;&#1072;&#1087;&#1080;&#1089;&#1100; &#1088;&#1072;&#1089;&#1095;&#1080;&#1090;&#1072;&#1085;&#1085;&#1099;&#1093; &#1093;&#1072;&#1088;&#1072;&#1082;&#1090;&#1077;&#1088;&#1080;&#1089;&#1090;&#1080;&#1082;<a name="17"></a></h2><pre class="codeinput">result.angle_time.angle = angle;
result.angle_time.time = (1:length(marker))*dt;
result.speed = mSpeedLE;
result.speed_absc = sxLE;
result.acceleration = mAccLE;
result.acceleration_absc = axLE;
result.leTime = leTime * dt;
result.leAbsc = leAbsc;
result.teTime = teTime * dt;
result.circleBeginTime = circleBeginTime;
</pre><h2>&#1042;&#1080;&#1079;&#1091;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103; &#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;&#1086;&#1074;<a name="18"></a></h2><p>figure hold on %plot(sx,mSpeed,'g') plot(sxLE,mSpeedLE,'r') plot(sxTE,mSpeedTE,'g') title('speed') set(gca,'XTick',0:720:angle(end)) hold off</p><p>figure hold on plot(axLE,mAccLE,'r') plot(axTE,mAccTE,'g') title('acceleration') set(gca,'XTick',0:720:angle(end)) hold off</p><p>figure hold on plot(angle(leAbsc),leTime*dt,'r') plot(angle(teAbsc),teTime*dt,'g') title('time(angle)') set(gca,'XTick',0:720:angle(end)) hold off</p><p>figure plot(ax,mAcc)</p><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.10<br></p></div><!--
##### SOURCE BEGIN #####
%% Обработка данных с отметчика
%% Описание функции
function [ result ] = getSpeedParams( marker, TDC, freq, marksPerCircle )
%getSpeedParams
%
%Входные параметры:
%   marker - ординаты отметчика
%   TDC - ординаты отметчика (вмт)
%   freq - частота (количество квантов в секунду)
%   marksPerCircle - количество отметок для одного оборота вала
%
%Выходные значения:
%   result - структура содержащая полученную информацию
%       result.circleBeginTime - абсцисса начала каждого цикла ()
%       result.circleEndTime - абсцисса конца каждого цикла
%       result.angle_time - структура, содержащая сопоставление угла
%                           поворота врмени.
%       result.speed - значение мгновенной скорости
%       result.speed_absc - значения абсциссы мгновенной скорости
%       result.acceleration - мгновенное значение ускорения
%       result.acceleration_absc - значения абсциссы ускорения
%       result.leTime - время между передними фронтами отметчика
%       result.teTime - время между задними фронтами отметчика

%% Инициализация

%угол, соответсвующий одной отметке
markAngle = 360/marksPerCircle;
markAngleRad = degtorad(markAngle);

angle = zeros(1,length(marker))*NaN; %значение угла в ячейках содержащих значение NaN будет рассчитано по мгновенной скорости
angle(1) = 0;
crossingTime = [];

%границы циклов (между двумя пиками отметчика)
circleBeginTime = [1];
circleEndTime = [];

%мгновенная скорость
mSpeed = [];
%мгновенное ускорение
mAcc = [];
%мгновенная скорость по времени между передними фронтами
mSpeedLE = [];
%мгновенное ускорение по времени между передними фронтами
mAccLE = [];
%мгновенная скорость по времени между задними фронтами
mSpeedTE = [];
%мгновенное ускорение по времени между задними фронтами
mAccTE = [];

len = length(marker);
dt = 1/freq;

%счетчик количества пересечений оси абсцисс
zeroCrossings = 0;

%время между фронтами
leTime = []; %le = leading edge
teTime = []; %te = tailing edge
leAbsc = [];
teAbsc = [];
%время обнаружения последнего фронта
lastLE = 0;
lastTE = 0;

%угол, на который был повернут вал в момент обнаружения первого локального
%максимума ординаты отметчика
initialCrossingsCount = NaN;

%локальный максимум ординта отметчика ВМТ
localMax = -inf;
%время обнаружения локального максимума
localMaxTime = 0;
%количество пересечений на момент обнаружения локального максимума
crossingsCountForLocalMax =  0;
%время пересечения, предшествующего максимуму
crossingTimeBeforeTDC = 0;
%время последнего пересечения
lastCrossingTime = 0;
%признак обнаружения локального максимума
localMaxFounded = 0;

%% Определение угла поворота и времени между фронтами
for i = 2:len    
    %отлавливаем пересечение нуля
    if((marker(1,i-1)>0 && marker(1,i) <= 0) || (marker(1,i-1) < 0 && marker(1,i) >= 0))
       %% расчитываем время между фронтами
        if((marker(1,i-1)<0 && marker(1,i) >= 0)) %передний фронт
            %Записываем время между передними фронтами
            leTime = [leTime (i - lastLE)];
            lastLE = i;
            leAbsc = [leAbsc i];
        else
            %Записываем время между задними фронтами
            teTime = [teTime (i - lastTE)];
            lastTE = i;
            %teAbsc = [teAbsc i];
        end
       %% считаем количество пересечений
        zeroCrossings = zeroCrossings+1;
        
       %% записываем время пересечения
        if localMaxFounded==0
            lastCrossingTime = i;
        end
       
        %% определяем границы циклов
        if (mod(zeroCrossings-initialCrossingsCount,2*marksPerCircle) == 0)
           circleBeginTime = [circleBeginTime i];
           circleEndTime = [circleEndTime i-1];
        end
        
        %% Записывем значения угла в текущий момент времени
        %crossingTime = [crossingTime i];
        angle(1,i) = zeroCrossings*markAngle;    

        %% Ищем локальный максимум
        % Локальный максимум ищется в промежутке от 0 до 720 градусов
        %обновляем значение максимума
        if zeroCrossings < 2*marksPerCircle
            if TDC(1,i) > localMax
                localMax = TDC(1,i);
                localMaxTime = i;
                crossingTimeBeforeTDC = lastCrossingTime;
                crossingsCountForLocalMax = zeroCrossings;
            end
        end
        %устанавливаем начало первого цикла
        if zeroCrossings == 2*marksPerCircle
            initialCrossingsCount = crossingsCountForLocalMax;
            circleBeginTime = crossingTimeBeforeTDC;
            circleEndTime = [];
            localMaxFounded = 1;
        end
    end
end

%% Расчет мгновенной скорости и ускорения
    %% Находим мгновенную скорость
%[sx mSpeed] = diff_pp(crossingTime*dt,angle(crossingTime));
%[sxTE mSpeedTE] = diff_pp(teAbsc*dt,angle(teAbsc));
[sxLE mSpeedLE] = diff_pp(leAbsc*dt,angle(leAbsc));

    %% Определяем значение угла поворота для любого момента времени
for i = 2:len
   if isnan(angle(i)) 
       %находим момент времени наиболее близкий к текущему
       [~, closestTime] = min(abs(sxLE-i*dt));
       angle(i) = angle(i-1) + mSpeedLE(closestTime) * dt;
   end
end

    %% устанавливаем нулевым угол соответсвующий началу первого цикла
angle = angle - initialCrossingsCount*markAngle;

    %% находим ускорение
[sxLE_unique n] = unique(sxLE,'first');
mSpeedLE_unique = mSpeedLE(n);
[axLE mAccLE] = diff_pp(sxLE_unique, mSpeedLE_unique);

%[sxTE_unique n] = unique(sxTE,'first');
%mSpeedTE_unique = mSpeedTE(n);
%[axTE mAccTE] = diff_pp(sxTE_unique, mSpeedTE_unique);

%% Запись расчитанных характеристик
result.angle_time.angle = angle;
result.angle_time.time = (1:length(marker))*dt;
result.speed = mSpeedLE;
result.speed_absc = sxLE;
result.acceleration = mAccLE;
result.acceleration_absc = axLE;
result.leTime = leTime * dt;
result.leAbsc = leAbsc;
result.teTime = teTime * dt;
result.circleBeginTime = circleBeginTime;

%% Визуализация результатов
% figure
% hold on
% %plot(sx,mSpeed,'g')
% plot(sxLE,mSpeedLE,'r')
% plot(sxTE,mSpeedTE,'g')
% title('speed')
% set(gca,'XTick',0:720:angle(end))
% hold off
% 
% figure 
% hold on
% plot(axLE,mAccLE,'r')
% plot(axTE,mAccTE,'g')
% title('acceleration')
% set(gca,'XTick',0:720:angle(end))
% hold off
% 
% figure 
% hold on
% plot(angle(leAbsc),leTime*dt,'r')
% plot(angle(teAbsc),teTime*dt,'g')
% title('time(angle)')
% set(gca,'XTick',0:720:angle(end))
% hold off
% 
% figure
% plot(ax,mAcc)

end


##### SOURCE END #####
--></body></html>